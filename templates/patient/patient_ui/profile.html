{% extends "basic.html" %}
{% load static %}
{% block body %}
<main id="main">
    <!-- ======= Breadcrumbs Section ======= -->
    <section class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <h2>Profile</h2>
        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="row justify-content-center align-items-center h-100">
                  <div class="col col-lg-6 mb-4 mb-lg-0">
                    <div class="card mb-3" style="border-radius: .5rem;">
                      <div class="row g-0">
                        <div class="col-md-4 gradient-custom text-center text-white"
                          style="border-top-left-radius: .5rem; border-bottom-left-radius: .5rem;">
                            {% if puser.patient.gender == "Male" %}
                            <img src="https://bootdey.com/img/Content/avatar/avatar6.png"
                              alt="Avatar" class="img-fluid my-5 rounded-circle" style="width: 80px;" />
                            {% else %}
                            <img src="https://bootdey.com/img/Content/avatar/avatar8.png"
                              alt="Avatar" class="img-fluid my-5 rounded-circle" style="width: 80px;" />
                            {% endif %}
                          <i class="far fa-edit mb-5"></i>
                        </div>
                        <div class="col-md-8">
                          <div class="card-body p-4">
                            <h6>Information</h6>
                            <hr class="mt-0 mb-4">
                            <div class="row pt-1">
                              <input class="form-control" id="userid" value="{{ request.user.id }}" hidden>
                              <div class="col mb-3">
                                <h6>First Name</h6>
                                <input class="form-control" id="fname" value="{{puser.patient.first_name}}">
                                <div id="error_fname" class="form-text"></div>
                              </div>
                            </div>
                            <div class="row pt-1">
                              <div class="col mb-3">
                                <h6>Middle Name</h6>
                                <input class="form-control" id="mname" value="{{puser.patient.middle_name}}">
                              </div>
                            </div>
                            <div class="row pt-1">
                              <div class="col mb-3">
                                <h6>Last Name</h6>
                                <input class="form-control" id="lname" value="{{puser.patient.last_name}}">
                                <div id="error_lname" class="form-text"></div>
                              </div>
                            </div>
                            <div class="row pt-1">
                              <div class="col mb-3">
                                <h6>Address</h6>
                                <input class="form-control" id="address" value="{{puser.patient.address}}">
                              </div>
                            </div>
                            <div class="row pt-1">
                              <div class="col mb-3">
                                <h6>Phone</h6>
                                <input class="form-control" id="contact" value="{{puser.patient.contact_number}}">
                                <div id="error_contact" class="form-text"></div>
                              </div>
                            </div>
                            <div class="row pt-1">
                              <div class="col mb-3">
                                <h6>Email</h6>
                                <input class="form-control" id="email" value="{{puser.email}}">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
              </div>
              <div class="modal-footer">
                <button type="button" id="save" class="btn btn-primary">Save changes</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section><!-- End Breadcrumbs Section -->

    <section class="inner-page">
      <div class="container">
          {% if request.user.last_login == None %}
          <div class="row align-items-center justify-content-center
              min-vh-100">
            <div class="col-12 col-md-8 col-lg-4">
              <div class="card shadow-sm">
                <div class="card-body">
                  <div class="mb-4">
                    <h5>Enter New Password</h5>
                    <p class="mb-2">You seing this because this is the first time you log in</p>
                  </div>
                  <form>
                    <div class="mb-3">
                      <label for="email" class="form-label">Password</label>
                      <input type="password" id="password" class="form-control" name="email" placeholder="Enter Your Email"
                        required="">
                    </div>
                    <div class="mb-3 d-grid">
                      <button type="submit" class="btn btn-primary">
                        Reset Password
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          {% else %}
          <div class="row justify-content-center align-items-center h-100">
            <div class="col col-lg-6 mb-4 mb-lg-0">
              <div class="card mb-3" style="border-radius: .5rem;">
                <div class="row g-0">
                  <div class="col-md-4 gradient-custom text-center text-white"
                    style="border-top-left-radius: .5rem; border-bottom-left-radius: .5rem;">
                      {% if puser.patient.gender == "Male" %}
                      <img src="https://bootdey.com/img/Content/avatar/avatar6.png"
                        alt="Avatar" class="img-fluid my-5 rounded-circle" style="width: 80px;" />
                      {% else %}
                      <img src="https://bootdey.com/img/Content/avatar/avatar8.png"
                        alt="Avatar" class="img-fluid my-5 rounded-circle" style="width: 80px;" />
                      {% endif %}
                      {% if request.user.patient %}
                        <div class="container mt-3 mb-3 ml-4 mr-4">
                          <div class="btn-group">
                            <button type="button" class="btn btn-primary pr-4 pl-4 mr-5 ml-5" data-bs-toggle="modal" data-bs-target="#exampleModal">Edit</button>
                          </div>
                        </div>
                      {% endif %}
                    <i class="far fa-edit mb-5"></i>
                  </div>
                  <div class="col-md-8">
                    <div class="card-body p-4">
                      <h6>Information</h6>
                      <hr class="mt-0 mb-4">
                      <div class="row pt-1">
                        <div class="col-6 mb-3">
                          <h6>Full Name</h6>
                          <p class="text-muted">{{puser.patient.full_name}}</p>
                        </div>
                        <div class="col-6 mb-3">
                          <h6>Gender</h6>
                          <p class="text-muted">{{puser.patient.gender}}</p>
                        </div>
                      </div>
                      <div class="row pt-1">
                        <div class="col-6 mb-3">
                          <h6>User Name</h6>
                          <p class="text-muted">{{ puser.username }}</p>
                        </div>
                        <div class="col-6 mb-3">
                          <h6>Email</h6>
                          <p class="text-muted">{{puser.email}}</p>
                        </div>
                      </div>
                      <div class="row pt-1">
                        <div class="col-6 mb-3">
                          <h6>Address</h6>
                          <p class="text-muted">{{ puser.patient.address }}</p>
                        </div>
                        <div class="col-6 mb-3">
                          <h6>Phone</h6>
                          <p class="text-muted">{{puser.patient.contact_number}}</p>
                        </div>
                      </div>
                      <h6>Others</h6>
                      <hr class="mt-0 mb-4">
                      <div class="row pt-1">
                        <div class="col-6 mb-3">
                          <h6>Recent Consultion</h6>
                          <p class="text-muted"></p>
                        </div>
                        <div class="col-6 mb-3">
                          <h6>Balance</h6>
                          <p class="text-muted">{{puser.patient.balance}}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
          {% endif %}

    </section>

  </main><!-- End #main -->

{% endblock %}
{% block custom_js %}
<script>

  $(document).ready( function(){
    $('#save').click( function(event){

    dob = document.getElementById('id_dob').value,


    $.ajax({
        url :"{% url 'savepdata' puser.username %}",
        type : "POST",
        data : {

        'csrfmiddlewaretoken': '{{ csrf_token }}',
        "name" :document.getElementById('id_name').value,
        "dob" :dob,
        "gender" :document.getElementById('id_gender').value,
        "address" :document.getElementById('id_address').value,
        "mobile_no" :document.getElementById('id_mobile_no').value

       },

        success : function(){
          alert("new data is saved.")
        }

    });


  });
});

</script>

<script>
  $('#save').click(function(){
    if($.trim($('#fname').val()).length == 0){
        error_fname = 'First Name is required';
        $('#error_fname').text(error_fname);
      }
      else{
        error_fname = '';
        $('#error_fname').text(error_fname);
      }
      if($.trim($('#lname').val()).length == 0){
          error_lname = 'Last Name is required';
          $('#error_lname').text(error_lname);
      }
      else{
          error_lname = '';
          $('#error_lname').text(error_lname);
      }
      if($.trim($('#address').val()).length == 0){
          error_address = 'Address is required';
          $('#error_address').text(error_address);
      }
      else{
          error_address = '';
          $('#error_address').text(error_address);
      }
      if($.trim($('#contact').val()).length == 0){
          error_contact = '';
          $('#error_contact').text(error_contact);
      }
      else if($.isNumeric($('#contact').val()) == false){
          error_contact= 'This must be a number!';
          $('#error_contact').text(error_contact);
      }else{
        error_contact = '';
        $('#error_contact').text(error_contact);
      }

      if (error_fname != '' || error_lname != '' || error_address != '' || error_contact != ''  ) {
       toastr.error("Correct error in the form")
     }else{
       var data = {
         'id': $('#userid').val(),
         'fname': $('#fname').val(),
         'lname': $('#lname').val(),
         'mname': $('#mname').val(),
         'lname': $('#lname').val(),
         'address': $('#address').val(),
         'contact': $('#contact').val(),
         'email': $('#email').val(),
       }
       $.ajax({
         type: "POST",
         url: "{% url 'edit_profile_patient' %}",
         data: data,
         dataType: "JSON",
         success:function(response){
           if(response.status == "success" ){
             $('#exampleModal').modal('hide');
             toastr.success(response.message)
             setTimeout(function () {
               location.reload(true);
             }, 2000);
           }else if (response.status == "error") {
             toastr.error(response.message)
           }
         },
       });
     }

  });
</script>

{% endblock %}
